{"version":3,"file":"ytsubmission_player.min.js","sources":["../src/ytsubmission_player.js"],"sourcesContent":["/**\n * JavaScript for YouTube player with timestamp support\n *\n * @module     assignsubmission_ytsubmission/ytsubmission_player\n * @copyright  2025 Mathieu Pelletier <mathieu@sats.ac.za>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/log'], function($, Log) {\n    'use strict';\n\n    /**\n     * YouTube player object\n     */\n    var player = null;\n    var videoId = null;\n    var timestamps = [];\n\n    /**\n     * Initialize the YouTube player\n     *\n     * @param {string} vid The YouTube video ID\n     */\n    var init = function(vid) {\n        videoId = vid;\n\n        // Load the YouTube IFrame API\n        if (typeof window.YT === 'undefined' || typeof window.YT.Player === 'undefined') {\n            var tag = document.createElement('script');\n            tag.src = \"https://www.youtube.com/iframe_api\";\n            var firstScriptTag = document.getElementsByTagName('script')[0];\n            firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);\n\n            // Wait for API to load\n            window.onYouTubeIframeAPIReady = function() {\n                initPlayer();\n            };\n        } else {\n            initPlayer();\n        }\n\n        // Set up timestamp button handler\n        setupTimestampControls();\n    };\n\n    /**\n     * Initialize the YouTube player object\n     */\n    var initPlayer = function() {\n        try {\n            var playerElement = document.getElementById('ytsubmission-player-' + videoId);\n            if (!playerElement) {\n                Log.debug('YouTube player element not found');\n                return;\n            }\n\n            // Wait for YT to be available\n            if (typeof window.YT === 'undefined' || typeof window.YT.Player === 'undefined') {\n                Log.debug('YouTube API not yet loaded, waiting...');\n                setTimeout(initPlayer, 100);\n                return;\n            }\n\n            player = new window.YT.Player('ytsubmission-player-' + videoId, {\n                events: {\n                    'onReady': onPlayerReady,\n                    'onError': onPlayerError\n                }\n            });\n        } catch (error) {\n            Log.error('Error initializing YouTube player: ' + error.message);\n        }\n    };\n\n    /**\n     * Called when the player is ready\n     */\n    var onPlayerReady = function() {\n        Log.debug('YouTube player ready');\n    };\n\n    /**\n     * Called when there is a player error\n     *\n     * @param {object} event The error event\n     */\n    var onPlayerError = function(event) {\n        Log.error('YouTube player error: ' + event.data);\n    };\n\n    /**\n     * Set up timestamp controls for teachers\n     */\n    var setupTimestampControls = function() {\n        var addTimestampBtn = $('#add-timestamp-btn');\n\n        if (addTimestampBtn.length === 0) {\n            // Not a teacher or controls not available\n            return;\n        }\n\n        // Handle add timestamp button click\n        addTimestampBtn.on('click', function() {\n            try {\n                if (!player || typeof player.getCurrentTime !== 'function') {\n                    Log.error('Player not ready');\n                    return;\n                }\n\n                // Get current video time\n                var currentTime = Math.floor(player.getCurrentTime());\n                var formattedTime = formatTime(currentTime);\n\n                // Create timestamp entry\n                var timestamp = {\n                    time: currentTime,\n                    formattedTime: formattedTime,\n                    note: ''\n                };\n\n                // Add to timestamps array\n                timestamps.push(timestamp);\n\n                // Render the timestamp in the list\n                renderTimestamp(timestamp, timestamps.length - 1);\n\n            } catch (error) {\n                Log.error('Error adding timestamp: ' + error.message);\n            }\n        });\n    };\n\n    /**\n     * Format time in seconds to MM:SS or HH:MM:SS format\n     *\n     * @param {number} seconds The time in seconds\n     * @return {string} Formatted time string\n     */\n    var formatTime = function(seconds) {\n        var hours = Math.floor(seconds / 3600);\n        var minutes = Math.floor((seconds % 3600) / 60);\n        var secs = seconds % 60;\n\n        if (hours > 0) {\n            return hours + ':' + pad(minutes) + ':' + pad(secs);\n        } else {\n            return minutes + ':' + pad(secs);\n        }\n    };\n\n    /**\n     * Pad a number with leading zero if needed\n     *\n     * @param {number} num The number to pad\n     * @return {string} Padded number string\n     */\n    var pad = function(num) {\n        return (num < 10 ? '0' : '') + num;\n    };\n\n    /**\n     * Render a timestamp in the timestamp list\n     *\n     * @param {object} timestamp The timestamp object\n     * @param {number} index The index in the timestamps array\n     */\n    var renderTimestamp = function(timestamp, index) {\n        var timestampList = $('#timestamp-list');\n\n        // Create timestamp item HTML\n        var timestampHtml = '<div class=\"timestamp-item\" data-index=\"' + index + '\" data-time=\"' + timestamp.time + '\">' +\n            '<span class=\"timestamp-time\">' + timestamp.formattedTime + '</span>' +\n            '<input type=\"text\" class=\"timestamp-note-input form-control\" placeholder=\"Add feedback note...\" ' +\n            'style=\"display: inline-block; width: 70%; margin-left: 10px;\" />' +\n            '<button class=\"btn btn-sm btn-danger delete-timestamp\" style=\"margin-left: 10px;\">Delete</button>' +\n            '</div>';\n\n        var $timestampItem = $(timestampHtml);\n        timestampList.append($timestampItem);\n\n        // Handle click on timestamp to seek video\n        $timestampItem.find('.timestamp-time').on('click', function() {\n            try {\n                if (player && typeof player.seekTo === 'function') {\n                    player.seekTo(timestamp.time, true);\n                    player.playVideo();\n                }\n            } catch (error) {\n                Log.error('Error seeking video: ' + error.message);\n            }\n        });\n\n        // Handle note input\n        $timestampItem.find('.timestamp-note-input').on('change', function() {\n            timestamps[index].note = $(this).val();\n            Log.debug('Timestamp note updated: ' + timestamps[index].note);\n        });\n\n        // Handle delete button\n        $timestampItem.find('.delete-timestamp').on('click', function() {\n            timestamps.splice(index, 1);\n            $timestampItem.remove();\n            // Re-render all timestamps to update indices\n            renderAllTimestamps();\n        });\n    };\n\n    /**\n     * Re-render all timestamps (used after deletion)\n     */\n    var renderAllTimestamps = function() {\n        var timestampList = $('#timestamp-list');\n        timestampList.empty();\n\n        timestamps.forEach(function(timestamp, index) {\n            renderTimestamp(timestamp, index);\n        });\n    };\n\n    /**\n     * Get all timestamps (can be called from grading form)\n     *\n     * @return {array} Array of timestamp objects\n     */\n    var getTimestamps = function() {\n        return timestamps;\n    };\n\n    // Public API\n    return {\n        init: init,\n        getTimestamps: getTimestamps\n    };\n});"],"names":["define","$","Log","player","videoId","timestamps","initPlayer","document","getElementById","debug","window","YT","Player","setTimeout","events","onPlayerReady","onPlayerError","error","message","event","data","setupTimestampControls","addTimestampBtn","length","on","getCurrentTime","currentTime","Math","floor","timestamp","time","formattedTime","formatTime","note","push","renderTimestamp","seconds","hours","minutes","secs","pad","num","index","timestampList","timestampHtml","$timestampItem","append","find","seekTo","playVideo","this","val","splice","remove","renderAllTimestamps","empty","forEach","init","vid","tag","createElement","src","firstScriptTag","getElementsByTagName","parentNode","insertBefore","onYouTubeIframeAPIReady","getTimestamps"],"mappings":";;;;;;;AAQAA,2DAAO,CAAC,SAAU,aAAa,SAASC,EAAGC,SAMnCC,OAAS,KACTC,QAAU,KACVC,WAAa,GAgCbC,WAAa,mBAEWC,SAASC,eAAe,uBAAyBJ,qBAEjEF,IAAIO,MAAM,4CAKW,IAAdC,OAAOC,SAAkD,IAArBD,OAAOC,GAAGC,cACrDV,IAAIO,MAAM,+CACVI,WAAWP,WAAY,KAI3BH,OAAS,IAAIO,OAAOC,GAAGC,OAAO,uBAAyBR,QAAS,CAC5DU,OAAQ,SACOC,sBACAC,iBAGrB,MAAOC,OACLf,IAAIe,MAAM,sCAAwCA,MAAMC,WAO5DH,cAAgB,WAChBb,IAAIO,MAAM,yBAQVO,cAAgB,SAASG,OACzBjB,IAAIe,MAAM,yBAA2BE,MAAMC,OAM3CC,uBAAyB,eACrBC,gBAAkBrB,EAAE,sBAEO,IAA3BqB,gBAAgBC,QAMpBD,gBAAgBE,GAAG,SAAS,mBAEfrB,QAA2C,mBAA1BA,OAAOsB,2BACzBvB,IAAIe,MAAM,wBAKVS,YAAcC,KAAKC,MAAMzB,OAAOsB,kBAIhCI,UAAY,CACZC,KAAMJ,YACNK,cALgBC,WAAWN,aAM3BO,KAAM,IAIV5B,WAAW6B,KAAKL,WAGhBM,gBAAgBN,UAAWxB,WAAWkB,OAAS,GAEjD,MAAON,OACLf,IAAIe,MAAM,2BAA6BA,MAAMC,cAWrDc,WAAa,SAASI,aAClBC,MAAQV,KAAKC,MAAMQ,QAAU,MAC7BE,QAAUX,KAAKC,MAAOQ,QAAU,KAAQ,IACxCG,KAAOH,QAAU,UAEjBC,MAAQ,EACDA,MAAQ,IAAMG,IAAIF,SAAW,IAAME,IAAID,MAEvCD,QAAU,IAAME,IAAID,OAU/BC,IAAM,SAASC,YACPA,IAAM,GAAK,IAAM,IAAMA,KAS/BN,gBAAkB,SAASN,UAAWa,WAClCC,cAAgB1C,EAAE,mBAGlB2C,cAAgB,2CAA6CF,MAAQ,gBAAkBb,UAAUC,KAAjF,kCACkBD,UAAUE,cAD5B,iRAOhBc,eAAiB5C,EAAE2C,eACvBD,cAAcG,OAAOD,gBAGrBA,eAAeE,KAAK,mBAAmBvB,GAAG,SAAS,eAEvCrB,QAAmC,mBAAlBA,OAAO6C,SACxB7C,OAAO6C,OAAOnB,UAAUC,MAAM,GAC9B3B,OAAO8C,aAEb,MAAOhC,OACLf,IAAIe,MAAM,wBAA0BA,MAAMC,aAKlD2B,eAAeE,KAAK,yBAAyBvB,GAAG,UAAU,WACtDnB,WAAWqC,OAAOT,KAAOhC,EAAEiD,MAAMC,MACjCjD,IAAIO,MAAM,2BAA6BJ,WAAWqC,OAAOT,SAI7DY,eAAeE,KAAK,qBAAqBvB,GAAG,SAAS,WACjDnB,WAAW+C,OAAOV,MAAO,GACzBG,eAAeQ,SAEfC,0BAOJA,oBAAsB,WACFrD,EAAE,mBACRsD,QAEdlD,WAAWmD,SAAQ,SAAS3B,UAAWa,OACnCP,gBAAgBN,UAAWa,iBAc5B,CACHe,KA/MO,SAASC,QAChBtD,QAAUsD,SAGe,IAAdhD,OAAOC,SAAkD,IAArBD,OAAOC,GAAGC,OAAwB,KACzE+C,IAAMpD,SAASqD,cAAc,UACjCD,IAAIE,IAAM,yCACNC,eAAiBvD,SAASwD,qBAAqB,UAAU,GAC7DD,eAAeE,WAAWC,aAAaN,IAAKG,gBAG5CpD,OAAOwD,wBAA0B,WAC7B5D,mBAGJA,aAIJe,0BA6LA8C,cAPgB,kBACT9D"}